# Как получить Google Maps API ключ БЕЗ банковской карты

## Проблема

Google Cloud требует привязку банковской карты для активации API, даже для использования бесплатного лимита ($200/месяц). Если у вас проблемы с верификацией банка, есть несколько решений.

## Решение 1: Использовать бесплатный пробный период (если доступен)

Google иногда предлагает бесплатный пробный период без карты:

1. Перейдите на [Google Cloud Console](https://console.cloud.google.com/)
2. Попробуйте создать проект
3. Проверьте, есть ли предложение бесплатного пробного периода
4. Если есть - активируйте его

**Ограничение**: Пробный период обычно ограничен по времени и функциональности.

## Решение 2: Использовать браузерный скрапер (БЕЗ API ключа)

Ваш проект уже включает браузерный скрапер, который работает **БЕЗ API ключа**!

### Как использовать

```python
from utils.lead_generation import ScraperConfig, GoogleMapsScraper

config = ScraperConfig(headless=True)
async with GoogleMapsScraper(config) as scraper:
    businesses = await scraper.search_businesses(
        query="kavárna",
        location="Praha 1",
        max_results=20
    )
    print(f"Найдено бизнесов: {len(businesses)}")
```

### Запуск основного скрипта

```bash
python scripts/collect_prague_businesses.py
```

Скрипт автоматически использует браузерный скрапер, если API ключ не настроен.

**Преимущества**:

- ✅ Не требует API ключа
- ✅ Не требует банковской карты
- ✅ Работает через браузер (Playwright)
- ✅ Уже интегрирован в ваш проект

**Ограничения**:

- Медленнее, чем API
- Может быть менее стабильным
- Требует установки Playwright

## Решение 3: Попробовать другой способ оплаты

### Вариант A: Виртуальная карта

Некоторые банки предлагают виртуальные карты для онлайн-платежей:

- Revolut (если доступен в вашей стране)
- Другие банки с виртуальными картами

### Вариант B: Предоплаченная карта

Попробуйте использовать предоплаченную карту с небольшим балансом.

**Внимание**: Google может не принимать некоторые типы карт.

## Решение 4: Использовать альтернативные API

### OpenStreetMap / Nominatim (бесплатно, без регистрации)

```python
import httpx

async def search_with_nominatim(query: str, location: str = "Prague"):
    """Поиск через Nominatim (OpenStreetMap)."""
    url = "https://nominatim.openstreetmap.org/search"
    params = {
        "q": f"{query} {location}",
        "format": "json",
        "limit": 20,
        "addressdetails": 1
    }

    async with httpx.AsyncClient() as client:
        response = await client.get(url, params=params)
        return response.json()
```

**Преимущества**:

- ✅ Полностью бесплатно
- ✅ Не требует регистрации
- ✅ Не требует карты

**Ограничения**:

- Меньше данных о бизнесах
- Нет рейтингов и отзывов
- Rate limiting (1 запрос/секунду)

### Foursquare Places API

Foursquare предлагает бесплатный план с ограничениями:

- Требует регистрацию
- Ограниченное количество запросов
- Может потребовать карту для некоторых функций

## Решение 5: Попросить друга/коллегу создать ключ

Если у вас есть друг или коллега, который может пройти верификацию:

1. Попросите их создать проект в Google Cloud
2. Создать API ключ
3. Ограничить ключ по IP адресам (ваш IP)
4. Передать вам ключ

**Безопасность**: Убедитесь, что ключ ограничен только необходимыми API и IP адресами.

## Рекомендация: Использовать браузерный скрапер

Для вашего случая **лучше всего использовать браузерный скрапер**, который уже есть в проекте:

1. **Не требует API ключа** - работает напрямую через браузер
2. **Не требует банковской карты** - полностью бесплатно
3. **Уже настроен** - просто запустите скрипт
4. **Достаточно для сбора данных** - получает все необходимые поля

### Быстрый старт

```bash
# Установите зависимости (если еще не установлены)
pip install playwright
playwright install chromium

# Запустите сбор данных
python scripts/collect_prague_businesses.py
```

Скрипт автоматически:

- Определит, что API ключ не настроен
- Использует браузерный скрапер
- Соберет данные о бизнесах
- Сохранит в CSV файл

## Настройка браузерного скрапера

Если нужно настроить параметры скрапера, отредактируйте `ScraperConfig`:

```python
from utils.lead_generation import ScraperConfig

config = ScraperConfig(
    headless=True,  # Запуск в фоновом режиме
    min_delay_seconds=2.0,  # Минимальная задержка между запросами
    max_delay_seconds=5.0,  # Максимальная задержка
    max_requests_per_hour=100,  # Лимит запросов в час
)
```

## Что делать, если браузерный скрапер не работает?

### Проблема: Playwright не установлен

```bash
pip install playwright
playwright install chromium
```

### Проблема: Блокировки от Google

1. Увеличьте задержки между запросами:

   ```python
   config = ScraperConfig(
       min_delay_seconds=5.0,
       max_delay_seconds=10.0
   )
   ```

2. Используйте headless=False для отладки:

   ```python
   config = ScraperConfig(headless=False)
   ```

3. Добавьте случайные задержки в код скрапера

### Проблема: Медленная работа

Браузерный скрапер медленнее API, это нормально. Для ускорения:

- Уменьшите количество запросов
- Используйте параллельные запросы (с осторожностью)
- Кешируйте результаты

## Итоговая рекомендация

**Для вашей ситуации**: Используйте браузерный скрапер - он уже настроен и работает без API ключа.

Когда сможете пройти верификацию банка:

1. Получите API ключ (см. GET_API_KEY.md)
2. Настройте его через `scripts/setup_api_key.py`
3. Система автоматически переключится на API (быстрее и надежнее)

## Дополнительная помощь

Если нужна помощь с настройкой браузерного скрапера или возникли проблемы:

1. Проверьте логи в `collect_prague_businesses.log`
2. Запустите с `headless=False` для отладки
3. Убедитесь, что Playwright установлен правильно
